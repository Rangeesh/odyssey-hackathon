{% if jobs %}
    {% for job in jobs %}
    <div class="job-card status-{{ job.status }} {% if forloop.counter > 1 %}minimized{% endif %}" 
         onclick="toggleJobCard(this, event)"
         data-job-id="{{ job.id }}">
        <div class="job-header">
            <h3>{{ job.song_title }}</h3>
            <div class="job-actions">
                <span class="status-badge status-{{ job.status }}">{{ job.get_status_display }}</span>
                {% if job.status == 'pending' or job.status == 'processing' %}
                <button class="cancel-btn" onclick="cancelJob('{{ job.id }}'); event.stopPropagation();">❌ Cancel</button>
                {% endif %}
                <span class="minimize-icon">▼</span>
            </div>
        </div>
        <div class="job-meta">
            <span>Artist: {{ job.artist }}</span>
            <span>Created: {{ job.created_at|date:"M d, Y H:i" }}</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ job.progress }}%;"></div>
            <span class="progress-text">{{ job.progress }}%</span>
        </div>
        <p class="status-message">{{ job.message }}</p>
        
        {% if job.status != 'completed' and job.segments %}
        <div class="segments-grid">
            {% for segment in job.segments %}
            <div class="segment-card {% if segment.status == 'video_ready' %}completed{% elif segment.status == 'image_ready' %}image-ready{% endif %}">
                <div class="segment-media">
                    {% if segment.video %}
                    <video autoplay loop muted playsinline>
                        <source src="{{ segment.video }}" type="video/mp4">
                    </video>
                    {% elif segment.image %}
                    <img src="{{ segment.image }}" alt="Scene {{ segment.index }}">
                    {% else %}
                    <div class="placeholder-media">
                        <span>Generating...</span>
                    </div>
                    {% endif %}
                </div>
                <div class="segment-lyrics">
                    <p>{{ segment.lyrics }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        {% if job.status == 'completed' and job.video_file %}
        <div class="video-container">
            <video controls playsinline width="100%">
                <source src="{{ job.video_file }}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <a href="{{ job.video_file }}" download class="download-btn">⬇️ Download Final Video</a>
        </div>
        {% endif %}
    </div>
    {% endfor %}
{% else %}
    <p class="no-jobs">No video jobs yet. Search for a song and generate your first video!</p>
{% endif %}
